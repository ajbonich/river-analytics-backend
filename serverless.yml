# serverless.yml

app: flowcasts-backend

service: python-api

provider:
    name: aws
    runtime: python3.8
    stage: dev
    region: us-east-2
    deploymentBucket:
        name: static-arn-bucket

plugins:
    - serverless-layers
    - serverless-deployment-bucket
    - serverless-python-requirements

custom:
    pythonRequirements:
        dockerizePip: non-linux
        layer: true
        zip: true
        slim: true
        strip: false
    serverless-layers:
        - NumpyArn:
            functions:
                - usgsDefaultDataAccess
                - usgsDailyAverageData
                - usgsDailyRunnablePercentage
            arn: arn:aws:lambda:us-east-2:770693421928:layer:Klayers-python38-numpy:12
        - PandasArn:
            functions:
                - usgsDefaultDataAccess
                - usgsDailyAverageData
                - usgsDailyRunnablePercentage
                - generateSiteForecast
            arn: arn:aws:lambda:us-east-2:770693421928:layer:Klayers-python38-pandas:23
functions:
    usgsDefaultDataAccess:
        handler: usgsController.getUSGSDefaultData
        events:
            - http:
                  path: /
                  method: get
                  cors: true
    usgsDailyAverageData:
        handler: usgsController.getDailyAverageData
        events:
            - http:
                  path: /getDailyAverageData
                  method: get
                  cors: true
    usgsDailyRunnablePercentage:
        handler: usgsController.getDailyRunnablePercentage
        events:
            - http:
                  path: /getRunnablePercentage
                  method: get
                  cors: true
    generateSiteForecast:
        handler: app/controllers/forecast_controller.get_forecast
        layers:
            - arn:aws:lambda:us-east-2:746562334669:layer:python-api-dev-python-requirements:1
        events:
            - http:
                  path: /forecast/{modelType}/{siteId}
                  method: get
                  cors: true
